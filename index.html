<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>FBI Pistol Qualification</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  /* Fonts & base */
  @import url("https://fonts.googleapis.com/css2?family=Inter:wght@600;800&family=Source+Serif+4:ital@0;1&display=swap");
  :root{--ink:#111;--muted:#666;--grid:#dcdcdc;--shade:#f7f7f7}
  html,body{background:#fff;color:var(--ink);margin:0}
  body{font:16px/1.55 "Source Serif 4", Georgia, serif}
  html{-webkit-text-size-adjust:100%}
  input,select,textarea{font-size:16px} /* prevent iOS zoom on focus */

  .wrap{max-width:960px;margin:28px auto 64px;padding:0 14px}
  h1{font:800 34px/1.15 Inter, system-ui, sans-serif;margin:0 0 6px}

  /* Intro bullets */
  .bullets{margin:8px 0 14px;padding-left:22px}
  .bullets li{margin:4px 0}

  /* Meta */
  .meta{margin:8px 0 10px}
  .meta-row{display:flex;align-items:center;gap:18px;margin:6px 0}
  .lbl{font:600 13px Inter;min-width:120px;color:#444}
  .line-input{flex:1;border:0;border-bottom:1px solid #999;padding:6px;background:transparent;font:16px/1.2 "Source Serif 4";outline:none}

  /* Toolbar */
  .toolbar{position:sticky;top:0;z-index:5;background:#fff;border-bottom:1px solid #eee;padding:8px 0 10px;display:flex;gap:8px;justify-content:flex-end}
  .btn{font:600 14px Inter;border:1px solid #999;background:#efefef;padding:8px 12px;border-radius:8px;cursor:pointer}
  .btn:active{transform:translateY(1px)}

  /* Table (screen: auto so Notes can breathe) */
  table{width:100%;border-collapse:collapse;table-layout:auto}
  thead th{font:700 14px Inter;color:#fff;background:#000;padding:8px;text-align:left}
  tbody td{padding:8px;border-bottom:1px solid var(--grid);vertical-align:middle}
  tbody tr:nth-child(even) td{background:var(--shade)}
  td,th{font-variant-numeric:tabular-nums}

  /* Column widths (screen) */
  .c-stage{width:7%; text-align:center}
  .c-dist{width:10%; text-align:center}
  .c-start{width:14%}
  .c-shots{width:8%; text-align:center}
  .c-time{width:10%; text-align:center}
  .c-hits{width:14%; text-align:center}
  .c-pts{width:8%; text-align:center}

  /* Bulletproof Notes wrapping */
  .c-notes, td.c-notes, th.c-notes{
    white-space:normal !important;
    overflow-wrap:anywhere;
    word-break:break-word;
    hyphens:auto; -webkit-hyphens:auto; -ms-hyphens:auto;
    line-break:anywhere;
    width:auto; min-width:300px;
  }

  /* Inputs & badges */
  .hits{width:96px;max-width:100%;padding:6px 8px;border:1px solid #bbb;border-radius:6px}
  .pts-badge{display:inline-block;min-width:44px;padding:6px 8px;border-radius:8px;background:#eef3ff;border:0;font:600 14px Inter;text-align:center}

  /* Totals */
  .totals{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:flex-end;margin-top:12px}
  .pill{font:700 13px Inter;border:1px solid #999;border-radius:999px;padding:8px 10px;background:#fafafa}
  .pass{background:#eaf8ee;border-color:#7bc490}
  .fail{background:#fdecec;border-color:#e39aa0}

  /* Signature lines */
  .signs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-top:18px}
  .sig .label{font:600 12px Inter;color:#555;margin-bottom:6px}
  .sig .line{border-bottom:1px solid #999;height:24px}

  /* Small screens */
  @media (max-width:560px){
    .wrap{padding:0 10px}
    thead th, tbody td{padding:6px}
    .hits{width:84px}
    .c-notes{min-width:240px}
  }

  /* Print – fixed widths so printers don’t crush Notes */
  @page{size:A4;margin:16mm 14mm}
  @media print{
    body{font-size:14px;line-height:1.45}
    .toolbar{display:none}
    thead{display:table-header-group}
    table{table-layout:fixed}
    thead th,tbody td{padding:6px}
    .line-input{border-bottom:1px solid #000}
    .sig .line{border-color:#000}

    th.c-stage, td.c-stage {width:8% !important}
    th.c-dist,  td.c-dist  {width:10% !important}
    th.c-start, td.c-start {width:14% !important}
    th.c-shots, td.c-shots {width:8% !important}
    th.c-time,  td.c-time  {width:10% !important}
    th.c-hits,  td.c-hits  {width:14% !important}
    th.c-pts,   td.c-pts   {width:8% !important}
    th.c-notes, td.c-notes {width:28% !important} /* keep Notes wide */
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>FBI Pistol Qualification</h1>

    <ul class="bullets">
      <li>Round count: <b>50</b>. Target: <b>QIT-99</b>.</li>
      <li>Scoring: hits inside the “bottle” are <b>2 points</b> each. Max <b>100</b>.</li>
      <li><b>PASS</b> requires <b>≥ 80 / 100</b>.</li>
    </ul>

    <div class="meta">
      <div class="meta-row">
        <div class="lbl">Date</div><input id="m_date" type="date" class="line-input" />
      </div>
      <div class="meta-row">
        <div class="lbl">Shooter</div><input id="m_shooter" type="text" class="line-input" placeholder="Name & surname" />
      </div>
      <div class="meta-row">
        <div class="lbl">Pistol</div><input id="m_pistol" type="text" class="line-input" placeholder="Model / Caliber" />
      </div>
    </div>

    <div class="toolbar">
      <button class="btn" id="btnExport">Export PDF</button>
      <button class="btn" id="btnClear">Clear</button>
    </div>

    <table id="tbl">
      <thead>
        <tr>
          <th class="c-stage">Stage</th>
          <th class="c-dist">Distance<br>(yards)</th>
          <th class="c-start">Start Position</th>
          <th class="c-shots">Shots</th>
          <th class="c-time">Time<br>(seconds)</th>
          <th class="c-notes">Notes</th>
          <th class="c-hits">Hits in “bottle”</th>
          <th class="c-pts">Points</th>
        </tr>
      </thead>
      <tbody>
        <tr data-shots="6">
          <td class="c-stage">1</td>
          <td class="c-dist">3</td>
          <td class="c-start">Draw</td>
          <td class="c-shots">6</td>
          <td class="c-time">6</td>
          <td class="c-notes">Fire 3 strong hand, switch hands, fire 3 weak hand.</td>
          <td class="c-hits"><input class="hits" type="number" min="0" max="6" step="1"></td>
          <td class="c-pts"><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="3">
          <td>2</td><td>5</td><td>Draw</td><td>3</td><td>3</td>
          <td class="c-notes">Draw and fire 3 shots in 3 seconds.</td>
          <td><input class="hits" type="number" min="0" max="3" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="3">
          <td>3</td><td>5</td><td>Ready</td><td>3</td><td>2</td>
          <td class="c-notes">From low ready, fire 3 shots in 2 seconds.</td>
          <td><input class="hits" type="number" min="0" max="3" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="6">
          <td>4</td><td>5</td><td>Ready</td><td>6</td><td>4</td>
          <td class="c-notes">From low ready, fire 6 shots in 4 seconds.</td>
          <td><input class="hits" type="number" min="0" max="6" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="5">
          <td>5</td><td>7</td><td>Draw</td><td>5</td><td>5</td>
          <td class="c-notes">Draw and fire 5 shots in 5 seconds.</td>
          <td><input class="hits" type="number" min="0" max="5" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="8">
          <td>6</td><td>7</td><td>Ready</td><td>8</td><td>8</td>
          <td class="c-notes">Fire 4 shots, reload, fire 4 more shots.</td>
          <td><input class="hits" type="number" min="0" max="8" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="5">
          <td>7</td><td>7</td><td>Ready</td><td>5</td><td>4</td>
          <td class="c-notes">From low ready, fire 5 shots in 4 seconds.</td>
          <td><input class="hits" type="number" min="0" max="5" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="3">
          <td>8</td><td>15</td><td>Draw</td><td>3</td><td>6</td>
          <td class="c-notes">Draw and fire 3 shots in 6 seconds.</td>
          <td><input class="hits" type="number" min="0" max="3" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="3">
          <td>9</td><td>15</td><td>Ready</td><td>3</td><td>5</td>
          <td class="c-notes">From low ready, fire 3 shots in 5 seconds.</td>
          <td><input class="hits" type="number" min="0" max="3" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
        <tr data-shots="8">
          <td>10</td><td>25</td><td>Draw</td><td>8</td><td>20</td>
          <td class="c-notes">Fire 4 shots, drop to kneeling, fire 4 more shots.</td>
          <td><input class="hits" type="number" min="0" max="8" step="1"></td>
          <td><span class="pts-badge">0</span></td>
        </tr>
      </tbody>
    </table>

    <div class="totals">
      <div class="pill">Total shots: <span id="totShots">50</span></div>
      <div class="pill">Max points: <span id="maxPts">100</span></div>
      <div class="pill">Points: <span id="sumPts">0</span></div>
      <div class="pill">Score: <span id="pct">0%</span></div>
      <div class="pill" id="passBadge">FAIL</div>
    </div>

    <div class="signs">
      <div class="sig"><div class="label">Instructor</div><div class="line"></div></div>
      <div class="sig"><div class="label">Shooter</div><div class="line"></div></div>
      <div class="sig"><div class="label">Location</div><div class="line"></div></div>
    </div>
  </div>

<script>
  const KEY = "fbi_pistol_qual_full_v1";

  function sumShots(){
    let s = 0;
    document.querySelectorAll('#tbl tbody tr').forEach(tr => s += +tr.dataset.shots);
    return s;
  }

  function recalc(){
    let points = 0, maxPts = 0;
    document.querySelectorAll('#tbl tbody tr').forEach(tr=>{
      const shots = +tr.dataset.shots;
      const hitsEl = tr.querySelector('.hits');
      let hits = parseInt(hitsEl.value||0,10);
      if(!isFinite(hits)) hits = 0;
      hits = Math.max(0, Math.min(hits, shots));
      hitsEl.value = hits;

      const stagePts = hits * 2; // bottle = 2 pts
      tr.querySelector('.pts-badge').textContent = stagePts;
      points += stagePts;
      maxPts += shots * 2;
    });

    document.getElementById('sumPts').textContent = points;
    document.getElementById('maxPts').textContent = maxPts;
    document.getElementById('totShots').textContent = sumShots();

    const pct = maxPts ? Math.round(points / maxPts * 100) : 0;
    document.getElementById('pct').textContent = pct + '%';

    const pass = points >= 80;
    const badge = document.getElementById('passBadge');
    badge.textContent = pass ? 'PASS' : 'FAIL';
    badge.classList.toggle('pass', pass);
    badge.classList.toggle('fail', !pass);

    saveState();
  }

  function saveState(){
    const rows = [...document.querySelectorAll('#tbl tbody tr')].map(tr => ({
      hits: tr.querySelector('.hits').value || ""
    }));
    const header = {
      date: document.getElementById('m_date').value || "",
      shooter: document.getElementById('m_shooter').value || "",
      pistol: document.getElementById('m_pistol').value || ""
    };
    localStorage.setItem(KEY, JSON.stringify({rows, header}));
  }

  function restore(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) { recalc(); return; }
      const obj = JSON.parse(raw);
      if(obj.header){
        document.getElementById('m_date').value   = obj.header.date    || "";
        document.getElementById('m_shooter').value= obj.header.shooter || "";
        document.getElementById('m_pistol').value = obj.header.pistol  || "";
      }
      const rows = document.querySelectorAll('#tbl tbody tr');
      (obj.rows||[]).forEach((r,i)=>{
        if(rows[i]) rows[i].querySelector('.hits').value = r.hits || "";
      });
      recalc();
    }catch(e){ console.error(e); }
  }

  function doExport(){
    const s = (document.getElementById('m_shooter').value || 'Shooter').replace(/\s+/g,'-');
    const d = (document.getElementById('m_date').value || new Date().toISOString().slice(0,10));
    const old = document.title;
    document.title = `FBI-Qual_${s}_${d}`;
    window.print();
    document.title = old;
  }

  // init
  document.addEventListener('DOMContentLoaded', ()=>{
    restore();
    document.querySelectorAll('.hits, #m_date, #m_shooter, #m_pistol').forEach(el => {
      el.addEventListener('input', recalc);
    });
    document.getElementById('btnExport').addEventListener('click', doExport);
    document.getElementById('btnClear').addEventListener('click', ()=>{
      document.querySelectorAll('.hits').forEach(i=>i.value="");
      document.getElementById('m_date').value="";
      document.getElementById('m_shooter').value="";
      document.getElementById('m_pistol').value="";
      localStorage.removeItem(KEY);
      recalc();
    });
  });
</script>
</body>
</html>
